## z-today メールの重複配信を防ぐ方法

### CPEリストにないソフトウェアの検索～メール配信の仕組み

- z-todayを使った、CPEに登録されていない脆弱性情報を検索してメール配信する処理は、z-todayメールの受信者からバッチファイル実行者へのメール転送に始まる。

- まず、バッチファイル実行者がメールの受信者から、"【脆弱性TODAY】本日の脆弱性情報"というタイトルのメールを受信すると、`Outlook`に登録したマクロが動作し、"【脆弱性TODAY】本日の脆弱性情報" に添付されている`html`ファイルをローカルPCに保存、このファイルに書かれたURLから圧縮ファイルをダウンロード、解凍する。

- 次に、'`nocpe.txt`' に記載したCPEリストにないソフトウェアを検索し、その結果をZドライブに保存する。サーバーは、定刻午後3時になると、`cron`に登録した`z-today-mail2.sh`を起動し、予め登録された宛先にメール配信する。

### メールの重複配信（すでに検索およびメール配信済みの結果の重複メール配信）を止める方法

#### バッチファイル実行者のローカルPC

1. 以下のフォルダーにある不要な`html`ファイルを削除する

- 例えば、`z-today0623_zip.html`と、`z-today0624_zip.html`がすでに処理済み（メール配信済み）の場合、`attachment`フォルダにあるこれらのファイルを削除する。

#### Zドライブ

2. 以下のフォルダーにある未実施状態にある`txt`ファイルを削除する

- ローカルPC上のバッチファイルが、動作してしまった場合には、Zドライブに、ファイルがコピーされている場合があるので、これらを削除する。例における、`[Project-A]NoCPE-z-today0623.txt`と、`[Project-A]NoCPE-z-today0623.txt`などが該当する。

- ※Zドライブ上のこのファイルを削除し忘れると、`cron`に登録した`z-today-mail2.sh`が動作してメールを配信してしまう
